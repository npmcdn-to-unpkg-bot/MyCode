<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">MUI 机器人</h1>
	</header>
	<div class="mui-content">
		<ul id="list" class="mui-table-view mui-table-view-chevron">
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right" href="im-chat.html">
                    chat（聊天窗口）
                </a>
            </li>
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right" href="list.html">
                    chat（聊天列表）
                </a>
            </li>
			<li class="mui-table-view-cell">
                <label>姓名</label><input id="name" type="text" />
            </li>
            <li class="mui-table-view-cell">
                <label>对象</label><input id="target" type="text" />
            </li>
            <li class="mui-table-view-cell">
                <label>信息</label><input id="content" type="text" />
            </li>
            <li class="mui-table-view-cell">
            	<input id="login" type="button" value="登录" />
                <input id="submit" type="button" value="发送" />
            </li>
		</ul>
	</div>
	<script src="js/jquery-1.10.2.js"></script>
	<script src="js/jquery.signalR-2.2.0.js"></script>
	<script src="http://localhost:8080/signalr/hubs"></script>
    <!--<script src="js/signalr.js"></script>-->
	<!--<script src="js/socket.js"></script> -->
	<script type="text/javascript">
	function writeLine(line) {
	    var messages = $("#list");
	    messages.append('<li class="mui-table-view-cell">' + getTimeString() + ' ' + line + "</li>");
	}
	
    function getTimeString() {
        var currentTime = new Date();
        return currentTime.toTimeString();
    }

	mui.ready(function(){
		var name = document.getElementById("name");
		var target = document.getElementById("target");
		var content = document.getElementById("content");
		var login = document.getElementById('login');
		var submit = document.getElementById("submit");

        $.connection.hub.url = "http://localhost:8080/signalr";
        var chat = $.connection.tLMHub;
        
        $.connection.hub.logging = true;
             
        chat.client.send = function (fromuser, touser, value) {
            var line = fromuser + '对' + touser + '说:' + value;
	        writeLine(line);
	    }     
     
        $.connection.hub.start()
            .done(function () {
                login.addEventListener('click', function(){
                    console.log("connected");
                    chat.server.connect(name.value);
                })
                submit.addEventListener('click', function(){
                    chat.server.send(target.value, content.value);
                })  
                
            })
            .fail(function (error) {
                console.log(value);
            });

	})
	</script>
</body>
</html>